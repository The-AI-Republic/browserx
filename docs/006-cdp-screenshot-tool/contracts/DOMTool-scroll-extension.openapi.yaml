openapi: 3.1.0
info:
  title: DOMTool Scroll Action Extension
  version: 1.0.0
  description: |
    Contract for the new 'scroll' action added to DOMTool as part of the CDP Screenshot Tool feature.

    This extension enables the LLM to explicitly scroll elements into viewport before capturing screenshots,
    providing precise control over viewport preparation.

paths:
  /tool/dom:
    post:
      summary: Execute DOMTool action (including new scroll action)
      description: |
        Execute a DOMTool action. This document focuses on the NEW 'scroll' action.
        See existing DOMTool.ts for other actions (snapshot, click, type, keypress).
      operationId: executeDOMToolAction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DOMToolRequest'
            examples:
              scrollAction:
                summary: Scroll element into view (default alignment)
                value:
                  action: scroll
                  node_id: 1537
              scrollWithOptions:
                summary: Scroll element to center of viewport
                value:
                  action: scroll
                  node_id: 1537
                  options:
                    block: center
                    inline: nearest
      responses:
        '200':
          description: Scroll action executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DOMToolResponse'
              examples:
                scrollSuccess:
                  summary: Element scrolled into view
                  value:
                    success: true
                    action: scroll
                    data:
                      node_id: 1537
                      scrolled: true
                      new_viewport_position:
                        scroll_x: 0
                        scroll_y: 1200
                    metadata:
                      duration_ms: 150
                      tab_id: 123
                      timestamp: "2025-10-31T12:00:00Z"
                      toolName: browser_dom
        '400':
          description: Invalid request (missing node_id, invalid options)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingNodeId:
                  summary: node_id is required for scroll action
                  value:
                    success: false
                    error:
                      code: VALIDATION_ERROR
                      message: "node_id is required for scroll action"
                      details:
                        action: scroll
                        missing_field: node_id
        '404':
          description: Element not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                elementNotFound:
                  summary: Node ID does not exist in DOM
                  value:
                    success: false
                    error:
                      code: ELEMENT_NOT_FOUND
                      message: "Element with node_id 1537 not found in DOM"
                      details:
                        node_id: 1537

components:
  schemas:
    DOMToolRequest:
      type: object
      required:
        - action
      properties:
        action:
          type: string
          description: |
            DOMTool action type.
            NEW: 'scroll' action added for explicit viewport management.
            Existing: 'snapshot', 'click', 'type', 'keypress'
          enum: [snapshot, click, type, keypress, scroll]
        tab_id:
          type: integer
          minimum: 1
          description: Target Chrome tab ID (defaults to active tab if omitted)
        node_id:
          type: integer
          minimum: 1
          description: Target element node ID (required for scroll, click, type actions)
        options:
          oneOf:
            - $ref: '#/components/schemas/ScrollOptions'
            - type: object
              description: Options for other actions (see DOMTool.ts)
      discriminator:
        propertyName: action

    ScrollOptions:
      type: object
      description: |
        Scroll behavior options controlling element alignment in viewport.
        Maps to Element.scrollIntoView() options.
      properties:
        block:
          type: string
          enum: [start, center, end, nearest]
          default: start
          description: |
            Vertical alignment:
            - start: Align top of element with top of viewport
            - center: Center element vertically in viewport
            - end: Align bottom of element with bottom of viewport
            - nearest: Minimal scroll to bring element into view
        inline:
          type: string
          enum: [start, center, end, nearest]
          default: nearest
          description: |
            Horizontal alignment:
            - start: Align left of element with left of viewport
            - center: Center element horizontally in viewport
            - end: Align right of element with right of viewport
            - nearest: Minimal scroll to bring element into view
      example:
        block: center
        inline: nearest

    DOMToolResponse:
      type: object
      required:
        - success
        - action
        - metadata
      properties:
        success:
          type: boolean
          description: Whether the action executed successfully
        action:
          type: string
          enum: [snapshot, click, type, keypress, scroll]
        data:
          oneOf:
            - $ref: '#/components/schemas/ScrollResponseData'
            - type: object
              description: Response data for other actions
        error:
          $ref: '#/components/schemas/ErrorDetails'
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    ScrollResponseData:
      type: object
      required:
        - node_id
        - scrolled
      properties:
        node_id:
          type: integer
          minimum: 1
          description: Node ID that was scrolled into view
        scrolled:
          type: boolean
          description: |
            Whether scrolling occurred.
            False if element was already fully visible (no scroll needed).
        new_viewport_position:
          type: object
          description: Viewport scroll position after scroll action
          required:
            - scroll_x
            - scroll_y
          properties:
            scroll_x:
              type: integer
              minimum: 0
              description: Horizontal scroll position (pixels from left)
            scroll_y:
              type: integer
              minimum: 0
              description: Vertical scroll position (pixels from top)
        element_position:
          type: object
          description: Element position after scroll (for verification)
          properties:
            x:
              type: integer
              description: Element X coordinate (viewport-relative)
            y:
              type: integer
              description: Element Y coordinate (viewport-relative)
            width:
              type: integer
              description: Element width in pixels
            height:
              type: integer
              description: Element height in pixels

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          const: false
        error:
          $ref: '#/components/schemas/ErrorDetails'
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    ErrorDetails:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - VALIDATION_ERROR
            - ELEMENT_NOT_FOUND
            - SCROLL_FAILED
            - TAB_NOT_FOUND
            - CDP_CONNECTION_LOST
          description: Error code identifier
        message:
          type: string
          description: Human-readable error description
        details:
          type: object
          additionalProperties: true
          description: Additional error context

    ResponseMetadata:
      type: object
      required:
        - duration_ms
        - tab_id
        - timestamp
        - toolName
      properties:
        duration_ms:
          type: integer
          minimum: 0
          description: Total action execution time in milliseconds
        tab_id:
          type: integer
          minimum: 1
          description: Tab where action was executed
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of response
        toolName:
          type: string
          const: browser_dom
          description: Tool identifier

tags:
  - name: dom
    description: DOM manipulation and inspection operations
  - name: scroll
    description: Viewport management and element scrolling

externalDocs:
  description: Integration with PageScreenShotTool workflow
  url: ../research.md#0-domtool-enhancement---explicit-scroll-action
